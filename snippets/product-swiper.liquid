<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

<style>
  .product-main-layout {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }

  .gallery-container {
    width: 100%;
  }

  .product-info {
    width: 100%;
  }

  @media (min-width: 768px) {
    .product-main-layout {
      flex-direction: row;
      justify-content: space-between;
    }

    .gallery-container,
    .product-info {
      flex: 1;
    }

    .gallery-container {
      max-width: 50%;
    }

    .product-info {
      padding-left: 20px;
    }
  }

  .product-swiper {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
  }

  .swiper-slide img {
    width: 100%;
    height: auto;
    display: block;
  }

  .swiper-button-next,
  .swiper-button-prev {
    color: black;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    top: 50%;
  }

  .swiper-button-next::after,
  .swiper-button-prev::after {
    font-size: 24px;
    font-weight: bold;
  }

  .swiper-button-next {
    right: 10px;
  }

  .swiper-button-prev {
    left: 10px;
  }

  @media (max-width: 767px) {
    .product-swiper {
      max-width: 100%;
    }

    .swiper-button-next,
    .swiper-button-prev {
      width: 32px;
      height: 32px;
      font-size: 18px;
    }
  }
</style>

<div class="swiper product-swiper">
  <div class="swiper-wrapper">
    {% for media in product.media %}
      {% if media.media_type == 'image' %}
        <div class="swiper-slide" data-color="{{ media.alt | downcase }}">
          {{ media | image_url: width: 500 | image_tag: alt: media.alt, class: 'product-image', loading: 'lazy' }}
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {% if section.settings.show_navigation %}
    <div class="swiper-button-next">&nbsp;</div>
    <div class="swiper-button-prev">&nbsp;</div>
  {% endif %}

  {% if section.settings.show_pagination %}
    <div class="swiper-pagination">&nbsp;</div>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
<script>
  let swiperInstance;
  let originalSlidesHTML = [];

  document.addEventListener('DOMContentLoaded', () => {
    const swiperWrapper = document.querySelector('.product-swiper .swiper-wrapper');
    
    if (!originalSlidesHTML.length) {
      originalSlidesHTML = Array.from(swiperWrapper.children).map(slide => slide.outerHTML);
    }

    function renderSlides(filteredSlidesHTML) {
      swiperWrapper.innerHTML = filteredSlidesHTML.join('');
    }

    function initProductSwiper() {
      if (swiperInstance) swiperInstance.destroy(true, true);
      swiperInstance = new Swiper('.product-swiper', {
        loop: true,
        spaceBetween: {{ section.settings.space_between | default: 10 }},
        slidesPerView: {{ section.settings.slides_per_view_mobile | default: 1 }},
        breakpoints: {
          768: { slidesPerView: {{ section.settings.slides_per_view_tablet | default: 2 }} },
          1200: { slidesPerView: {{ section.settings.slides_per_view_desktop | default: 3 }} }
        },
        {% if section.settings.show_navigation %}
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
        {% endif %}
        {% if section.settings.show_pagination %}
        pagination: { el: '.swiper-pagination', clickable: true },
        {% endif %}
      });
    }

    function filterSlidesByVariant(variantTitle) {
      let filteredSlidesHTML = originalSlidesHTML.filter(slideHTML => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = slideHTML;
        const slideDiv = tempDiv.querySelector('.swiper-slide');
        if (!variantTitle) return true;
        return slideDiv.getAttribute('data-color') === variantTitle.trim().toLowerCase();
      });
      renderSlides(filteredSlidesHTML);
      initProductSwiper();
    }
    
    const colorRadios = document.querySelectorAll('input[type="radio"][name^="Color"]');
    let initialTitle = '';
    colorRadios.forEach((radio) => {
      if (radio.checked) initialTitle = radio.value;
      radio.addEventListener('change', (e) => {
        filterSlidesByVariant(e.target.value.toLowerCase());
      });
    });
    filterSlidesByVariant(initialTitle.toLowerCase());
  });
</script>